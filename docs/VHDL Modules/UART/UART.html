


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>UART, Serial Port, RS-232 Interface - VHDL Development</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="purple">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#uart-serial-port-rs-232-interface" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="VHDL Development" class="md-header-nav__button md-logo" aria-label="VHDL Development">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            VHDL Development
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              UART, Serial Port, RS-232 Interface
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="VHDL Development" class="md-nav__button md-logo" aria-label="VHDL Development">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    VHDL Development
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../VHDL.html" title="VHDL" class="md-nav__link">
      VHDL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-in-both-vhdl-and-verilog-for-fpga-implementation" class="md-nav__link">
    Code in both VHDL and Verilog for FPGA Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vhdl-implementation" class="md-nav__link">
    VHDL Implementation
  </a>
  
    <nav class="md-nav" aria-label="VHDL Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vhdl-receiver-uart_rxvhd" class="md-nav__link">
    VHDL Receiver (UART_RX.vhd):
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhdl-transmitter-uart_txvhd" class="md-nav__link">
    VHDL Transmitter (UART_TX.vhd)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhdl-testbench-uart_tbvhd" class="md-nav__link">
    VHDL Testbench (UART_TB.vhd)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="uart-serial-port-rs-232-interface">UART, Serial Port, RS-232 Interface</h1>
<h2 id="code-in-both-vhdl-and-verilog-for-fpga-implementation">Code in both VHDL and Verilog for FPGA Implementation</h2>
<p>Do you know how a UART works? If not, first brush up on the basics of UARTs before continuing on.
Have you considered how you might sample data with an FPGA? Think about data coming into your FPGA.
Data can arrive by itself or it can arrive with a clock. When it arrives with a clock, it is call synchronous.
When it arrives without a clock, it is called asynchronous. A UART is an asynchronous interface.</p>
<p>In any asynchronous interface, the first thing you need to know is when in time you should sample (look at) the data. If you do not sample the data at the right time, you might see the wrong data. In order to receive your data correctly, the transmitter and receiver must agree on the baud rate. The baud rate is the rate at which the data is transmitted. For example, 9600 baud means 9600 bits per second. The code below uses a generic in VHDL or a parameter in Verilog to determine how many clock cycles there are in each bit. This is how the baud rate gets determined.</p>
<p>The FPGA is continuously sampling the line. Once it sees the line transition from high to low, it knows that a UART data word is coming.
This first transition indicates the start bit. Once the beginning of the start bit is found, the FPGA waits for one half of a bit period.
This ensures that the middle of the data bit gets sampled.
From then on, the FPGA just needs to wait one bit period (as specified by the baud rate) and sample the rest of the data.
The figure below shows how the UART receiver works inside of the FPGA. First a falling edge is detected on the serial data line.
This represents the start bit. The FPGA then waits until the middle of the first data bit and samples the data.
It does this for all eight data bits.</p>
<p>Inline Style:
<img alt="alt text" src="uart_byte_sampling.png" title="Uart Byte Sampling - Inline" /></p>
<p>The above data stream shows how the code below is structured.
The code below uses one Start Bit, one Stop Bit, eight Data Bits, and no parity.
Note that the transmitter modules below both have a signal o_tx_active.
This is used to infer a tri-state buffer for half-duplex communication.
It is up your specific project requirements if you want to create a half-duplex UART or a full-duplex UART. The code below will work for both!</p>
<p>If you want to simulate your code (and you should) you need to use a testbench.
Luckily there is a test bench already created for you! This testbench below exercises both the Transmitter and the Receiver code.
It is programmed to work at 115200 baud. Note that this test bench is for simulation only and can not be synthesized into functional FPGA code.</p>
<h2 id="vhdl-implementation">VHDL Implementation</h2>
<h3 id="vhdl-receiver-uart_rxvhd">VHDL Receiver (UART_RX.vhd):</h3>
<p><a href="UART_RX.vhd">UART_RX.vhd</a></p>
<div class="codehilite"><pre><span></span><code><span class="c1">----------------------------------------------------------------------</span>
<span class="c1">-- File Downloaded from http://www.nandland.com</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="c1">-- This file contains the UART Receiver.  This receiver is able to</span>
<span class="c1">-- receive 8 bits of serial data, one start bit, one stop bit,</span>
<span class="c1">-- and no parity bit.  When receive is complete o_rx_dv will be</span>
<span class="c1">-- driven high for one clock cycle.</span>
<span class="c1">--</span>
<span class="c1">-- Set Generic g_CLKS_PER_BIT as follows:</span>
<span class="c1">-- g_CLKS_PER_BIT = (Frequency of i_Clk)/(Frequency of UART)</span>
<span class="c1">-- Example: 10 MHz Clock, 115200 baud UART</span>
<span class="c1">-- (10000000)/(115200) = 87</span>
<span class="c1">--</span>
<span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">ALL</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.numeric_std.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">UART_RX</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span>
    <span class="n">g_CLKS_PER_BIT</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">115</span>     <span class="c1">-- Needs to be set correctly</span>
    <span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">i_Clk</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">i_RX_Serial</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">o_RX_DV</span>     <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">o_RX_Byte</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">);</span>
<span class="k">end</span> <span class="nc">UART_RX</span><span class="p">;</span>


<span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">UART_RX</span> <span class="k">is</span>

  <span class="k">type</span> <span class="n">t_SM_Main</span> <span class="k">is</span> <span class="p">(</span><span class="n">s_Idle</span><span class="p">,</span> <span class="n">s_RX_Start_Bit</span><span class="p">,</span> <span class="n">s_RX_Data_Bits</span><span class="p">,</span>
                     <span class="n">s_RX_Stop_Bit</span><span class="p">,</span> <span class="n">s_Cleanup</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r_SM_Main</span> <span class="o">:</span> <span class="n">t_SM_Main</span> <span class="o">:=</span> <span class="n">s_Idle</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">r_RX_Data_R</span> <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">r_RX_Data</span>   <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">r_Clk_Count</span> <span class="o">:</span> <span class="kt">integer</span> <span class="k">range</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">r_Bit_Index</span> <span class="o">:</span> <span class="kt">integer</span> <span class="k">range</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">7</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">-- 8 Bits Total</span>
  <span class="k">signal</span> <span class="n">r_RX_Byte</span>   <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="p">(</span><span class="k">others</span> <span class="o">=&gt;</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r_RX_DV</span>     <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>

<span class="k">begin</span>

  <span class="c1">-- Purpose: Double-register the incoming data.</span>
  <span class="c1">-- This allows it to be used in the UART RX Clock Domain.</span>
  <span class="c1">-- (It removes problems caused by metastabiliy)</span>
  <span class="n">p_SAMPLE</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">r_RX_Data_R</span> <span class="o">&lt;=</span> <span class="n">i_RX_Serial</span><span class="p">;</span>
      <span class="n">r_RX_Data</span>   <span class="o">&lt;=</span> <span class="n">r_RX_Data_R</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">p_SAMPLE</span><span class="p">;</span>


  <span class="c1">-- Purpose: Control RX state machine</span>
  <span class="n">p_UART_RX</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span> <span class="k">then</span>

      <span class="k">case</span> <span class="n">r_SM_Main</span> <span class="k">is</span>

        <span class="k">when</span> <span class="n">s_Idle</span> <span class="o">=&gt;</span>
          <span class="n">r_RX_DV</span>     <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
          <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>

          <span class="k">if</span> <span class="n">r_RX_Data</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span> <span class="k">then</span>       <span class="c1">-- Start bit detected</span>
            <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_RX_Start_Bit</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Check middle of start bit to make sure it&#39;s still low</span>
        <span class="k">when</span> <span class="n">s_RX_Start_Bit</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">then</span>
            <span class="k">if</span> <span class="n">r_RX_Data</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span> <span class="k">then</span>
              <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">-- reset counter since we found the middle</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Data_Bits</span><span class="p">;</span>
            <span class="k">else</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>
            <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Start_Bit</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Wait g_CLKS_PER_BIT-1 clock cycles to sample serial data</span>
        <span class="k">when</span> <span class="n">s_RX_Data_Bits</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">&lt;</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Data_Bits</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_Clk_Count</span>            <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">r_RX_Byte</span><span class="p">(</span><span class="n">r_Bit_Index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">r_RX_Data</span><span class="p">;</span>

            <span class="c1">-- Check if we have sent out all bits</span>
            <span class="k">if</span> <span class="n">r_Bit_Index</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="k">then</span>
              <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="n">r_Bit_Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Data_Bits</span><span class="p">;</span>
            <span class="k">else</span>
              <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Stop_Bit</span><span class="p">;</span>
            <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Receive Stop bit.  Stop bit = 1</span>
        <span class="k">when</span> <span class="n">s_RX_Stop_Bit</span> <span class="o">=&gt;</span>
          <span class="c1">-- Wait g_CLKS_PER_BIT-1 clock cycles for Stop bit to finish</span>
          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">&lt;</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_RX_Stop_Bit</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_RX_DV</span>     <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_Cleanup</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Stay here 1 clock</span>
        <span class="k">when</span> <span class="n">s_Cleanup</span> <span class="o">=&gt;</span>
          <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>
          <span class="n">r_RX_DV</span>   <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>


        <span class="k">when</span> <span class="k">others</span> <span class="o">=&gt;</span>
          <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>

      <span class="k">end</span> <span class="k">case</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">p_UART_RX</span><span class="p">;</span>

  <span class="n">o_RX_DV</span>   <span class="o">&lt;=</span> <span class="n">r_RX_DV</span><span class="p">;</span>
  <span class="n">o_RX_Byte</span> <span class="o">&lt;=</span> <span class="n">r_RX_Byte</span><span class="p">;</span>

<span class="k">end</span> <span class="nc">rtl</span><span class="p">;</span>
</code></pre></div>


<h3 id="vhdl-transmitter-uart_txvhd">VHDL Transmitter (UART_TX.vhd)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">----------------------------------------------------------------------</span>
<span class="c1">-- File Downloaded from http://www.nandland.com</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="c1">-- This file contains the UART Transmitter.  This transmitter is able</span>
<span class="c1">-- to transmit 8 bits of serial data, one start bit, one stop bit,</span>
<span class="c1">-- and no parity bit.  When transmit is complete o_TX_Done will be</span>
<span class="c1">-- driven high for one clock cycle.</span>
<span class="c1">--</span>
<span class="c1">-- Set Generic g_CLKS_PER_BIT as follows:</span>
<span class="c1">-- g_CLKS_PER_BIT = (Frequency of i_Clk)/(Frequency of UART)</span>
<span class="c1">-- Example: 10 MHz Clock, 115200 baud UART</span>
<span class="c1">-- (10000000)/(115200) = 87</span>
<span class="c1">--</span>
<span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.numeric_std.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">UART_TX</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span>
    <span class="n">g_CLKS_PER_BIT</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">115</span>     <span class="c1">-- Needs to be set correctly</span>
    <span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">i_Clk</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">i_TX_DV</span>     <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">i_TX_Byte</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">o_TX_Active</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">o_TX_Serial</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">o_TX_Done</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
    <span class="p">);</span>
<span class="k">end</span> <span class="nc">UART_TX</span><span class="p">;</span>


<span class="k">architecture</span> <span class="nc">RTL</span> <span class="k">of</span> <span class="nc">UART_TX</span> <span class="k">is</span>

  <span class="k">type</span> <span class="n">t_SM_Main</span> <span class="k">is</span> <span class="p">(</span><span class="n">s_Idle</span><span class="p">,</span> <span class="n">s_TX_Start_Bit</span><span class="p">,</span> <span class="n">s_TX_Data_Bits</span><span class="p">,</span>
                     <span class="n">s_TX_Stop_Bit</span><span class="p">,</span> <span class="n">s_Cleanup</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r_SM_Main</span> <span class="o">:</span> <span class="n">t_SM_Main</span> <span class="o">:=</span> <span class="n">s_Idle</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">r_Clk_Count</span> <span class="o">:</span> <span class="kt">integer</span> <span class="k">range</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">r_Bit_Index</span> <span class="o">:</span> <span class="kt">integer</span> <span class="k">range</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">7</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">-- 8 Bits Total</span>
  <span class="k">signal</span> <span class="n">r_TX_Data</span>   <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="p">(</span><span class="k">others</span> <span class="o">=&gt;</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r_TX_Done</span>   <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>

<span class="k">begin</span>


  <span class="n">p_UART_TX</span> <span class="o">:</span> <span class="k">process</span> <span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">i_Clk</span><span class="p">)</span> <span class="k">then</span>

      <span class="k">case</span> <span class="n">r_SM_Main</span> <span class="k">is</span>

        <span class="k">when</span> <span class="n">s_Idle</span> <span class="o">=&gt;</span>
          <span class="n">o_TX_Active</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
          <span class="n">o_TX_Serial</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>         <span class="c1">-- Drive Line High for Idle</span>
          <span class="n">r_TX_Done</span>   <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
          <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>

          <span class="k">if</span> <span class="n">i_TX_DV</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span> <span class="k">then</span>
            <span class="n">r_TX_Data</span> <span class="o">&lt;=</span> <span class="n">i_TX_Byte</span><span class="p">;</span>
            <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_TX_Start_Bit</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Send out Start Bit. Start bit = 0</span>
        <span class="k">when</span> <span class="n">s_TX_Start_Bit</span> <span class="o">=&gt;</span>
          <span class="n">o_TX_Active</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
          <span class="n">o_TX_Serial</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>

          <span class="c1">-- Wait g_CLKS_PER_BIT-1 clock cycles for start bit to finish</span>
          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">&lt;</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Start_Bit</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Data_Bits</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Wait g_CLKS_PER_BIT-1 clock cycles for data bits to finish          </span>
        <span class="k">when</span> <span class="n">s_TX_Data_Bits</span> <span class="o">=&gt;</span>
          <span class="n">o_TX_Serial</span> <span class="o">&lt;=</span> <span class="n">r_TX_Data</span><span class="p">(</span><span class="n">r_Bit_Index</span><span class="p">);</span>

          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">&lt;</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Data_Bits</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="c1">-- Check if we have sent out all bits</span>
            <span class="k">if</span> <span class="n">r_Bit_Index</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="k">then</span>
              <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="n">r_Bit_Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Data_Bits</span><span class="p">;</span>
            <span class="k">else</span>
              <span class="n">r_Bit_Index</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Stop_Bit</span><span class="p">;</span>
            <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Send out Stop bit.  Stop bit = 1</span>
        <span class="k">when</span> <span class="n">s_TX_Stop_Bit</span> <span class="o">=&gt;</span>
          <span class="n">o_TX_Serial</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>

          <span class="c1">-- Wait g_CLKS_PER_BIT-1 clock cycles for Stop bit to finish</span>
          <span class="k">if</span> <span class="n">r_Clk_Count</span> <span class="o">&lt;</span> <span class="n">g_CLKS_PER_BIT</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="n">r_Clk_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_TX_Stop_Bit</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">r_TX_Done</span>   <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
            <span class="n">r_Clk_Count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_Cleanup</span><span class="p">;</span>
          <span class="k">end</span> <span class="k">if</span><span class="p">;</span>


        <span class="c1">-- Stay here 1 clock</span>
        <span class="k">when</span> <span class="n">s_Cleanup</span> <span class="o">=&gt;</span>
          <span class="n">o_TX_Active</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
          <span class="n">r_TX_Done</span>   <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
          <span class="n">r_SM_Main</span>   <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>


        <span class="k">when</span> <span class="k">others</span> <span class="o">=&gt;</span>
          <span class="n">r_SM_Main</span> <span class="o">&lt;=</span> <span class="n">s_Idle</span><span class="p">;</span>

      <span class="k">end</span> <span class="k">case</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">p_UART_TX</span><span class="p">;</span>

  <span class="n">o_TX_Done</span> <span class="o">&lt;=</span> <span class="n">r_TX_Done</span><span class="p">;</span>

<span class="k">end</span> <span class="nc">RTL</span><span class="p">;</span>
</code></pre></div>


<h3 id="vhdl-testbench-uart_tbvhd">VHDL Testbench (UART_TB.vhd)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">----------------------------------------------------------------------</span>
<span class="c1">-- File Downloaded from http://www.nandland.com</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">ALL</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.numeric_std.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">uart_tb</span> <span class="k">is</span>
<span class="k">end</span> <span class="nc">uart_tb</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">behave</span> <span class="k">of</span> <span class="nc">uart_tb</span> <span class="k">is</span>

  <span class="k">component</span> <span class="nc">uart_tx</span> <span class="k">is</span>
    <span class="k">generic</span> <span class="p">(</span>
      <span class="n">g_CLKS_PER_BIT</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">115</span>   <span class="c1">-- Needs to be set correctly</span>
      <span class="p">);</span>
    <span class="k">port</span> <span class="p">(</span>
      <span class="n">i_clk</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">i_tx_dv</span>     <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">i_tx_byte</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">o_tx_active</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">o_tx_serial</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">o_tx_done</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span>
      <span class="p">);</span>
  <span class="k">end</span> <span class="k">component</span> <span class="nc">uart_tx</span><span class="p">;</span>

  <span class="k">component</span> <span class="nc">uart_rx</span> <span class="k">is</span>
    <span class="k">generic</span> <span class="p">(</span>
      <span class="n">g_CLKS_PER_BIT</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">115</span>   <span class="c1">-- Needs to be set correctly</span>
      <span class="p">);</span>
    <span class="k">port</span> <span class="p">(</span>
      <span class="n">i_clk</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">i_rx_serial</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">o_rx_dv</span>     <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">;</span>
      <span class="n">o_rx_byte</span>   <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">);</span>
  <span class="k">end</span> <span class="k">component</span> <span class="nc">uart_rx</span><span class="p">;</span>


  <span class="c1">-- Test Bench uses a 10 MHz Clock</span>
  <span class="c1">-- Want to interface to 115200 baud UART</span>
  <span class="c1">-- 10000000 / 115200 = 87 Clocks Per Bit.</span>
  <span class="k">constant</span> <span class="n">c_CLKS_PER_BIT</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">87</span><span class="p">;</span>

  <span class="k">constant</span> <span class="n">c_BIT_PERIOD</span> <span class="o">:</span> <span class="kt">time</span> <span class="o">:=</span> <span class="mi">8680</span> <span class="n">ns</span><span class="p">;</span>

  <span class="k">signal</span> <span class="n">r_CLOCK</span>     <span class="o">:</span> <span class="kt">std_logic</span>                    <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">r_TX_DV</span>     <span class="o">:</span> <span class="kt">std_logic</span>                    <span class="o">:=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">r_TX_BYTE</span>   <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="p">(</span><span class="k">others</span> <span class="o">=&gt;</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">w_TX_SERIAL</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">w_TX_DONE</span>   <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">w_RX_DV</span>     <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
  <span class="k">signal</span> <span class="n">w_RX_BYTE</span>   <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">r_RX_SERIAL</span> <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>


  <span class="c1">-- Low-level byte-write</span>
  <span class="k">procedure</span> <span class="n">UART_WRITE_BYTE</span> <span class="p">(</span>
    <span class="n">i_data_in</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">signal</span> <span class="n">o_serial</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic</span><span class="p">)</span> <span class="k">is</span>
  <span class="k">begin</span>

    <span class="c1">-- Send Start Bit</span>
    <span class="n">o_serial</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
    <span class="k">wait</span> <span class="k">for</span> <span class="n">c_BIT_PERIOD</span><span class="p">;</span>

    <span class="c1">-- Send Data Byte</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="k">in</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">7</span> <span class="k">loop</span>
      <span class="n">o_serial</span> <span class="o">&lt;=</span> <span class="n">i_data_in</span><span class="p">(</span><span class="n">ii</span><span class="p">);</span>
      <span class="k">wait</span> <span class="k">for</span> <span class="n">c_BIT_PERIOD</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>  <span class="c1">-- ii</span>

    <span class="c1">-- Send Stop Bit</span>
    <span class="n">o_serial</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
    <span class="k">wait</span> <span class="k">for</span> <span class="n">c_BIT_PERIOD</span><span class="p">;</span>
  <span class="k">end</span> <span class="nc">UART_WRITE_BYTE</span><span class="p">;</span>


<span class="k">begin</span>

  <span class="c1">-- Instantiate UART transmitter</span>
  <span class="n">UART_TX_INST</span> <span class="o">:</span> <span class="n">uart_tx</span>
    <span class="k">generic</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">g_CLKS_PER_BIT</span> <span class="o">=&gt;</span> <span class="n">c_CLKS_PER_BIT</span>
      <span class="p">)</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">i_clk</span>       <span class="o">=&gt;</span> <span class="n">r_CLOCK</span><span class="p">,</span>
      <span class="n">i_tx_dv</span>     <span class="o">=&gt;</span> <span class="n">r_TX_DV</span><span class="p">,</span>
      <span class="n">i_tx_byte</span>   <span class="o">=&gt;</span> <span class="n">r_TX_BYTE</span><span class="p">,</span>
      <span class="n">o_tx_active</span> <span class="o">=&gt;</span> <span class="k">open</span><span class="p">,</span>
      <span class="n">o_tx_serial</span> <span class="o">=&gt;</span> <span class="n">w_TX_SERIAL</span><span class="p">,</span>
      <span class="n">o_tx_done</span>   <span class="o">=&gt;</span> <span class="n">w_TX_DONE</span>
      <span class="p">);</span>

  <span class="c1">-- Instantiate UART Receiver</span>
  <span class="n">UART_RX_INST</span> <span class="o">:</span> <span class="n">uart_rx</span>
    <span class="k">generic</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">g_CLKS_PER_BIT</span> <span class="o">=&gt;</span> <span class="n">c_CLKS_PER_BIT</span>
      <span class="p">)</span>
    <span class="k">port</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">i_clk</span>       <span class="o">=&gt;</span> <span class="n">r_CLOCK</span><span class="p">,</span>
      <span class="n">i_rx_serial</span> <span class="o">=&gt;</span> <span class="n">r_RX_SERIAL</span><span class="p">,</span>
      <span class="n">o_rx_dv</span>     <span class="o">=&gt;</span> <span class="n">w_RX_DV</span><span class="p">,</span>
      <span class="n">o_rx_byte</span>   <span class="o">=&gt;</span> <span class="n">w_RX_BYTE</span>
      <span class="p">);</span>

  <span class="n">r_CLOCK</span> <span class="o">&lt;=</span> <span class="k">not</span> <span class="n">r_CLOCK</span> <span class="k">after</span> <span class="mi">50</span> <span class="n">ns</span><span class="p">;</span>

  <span class="k">process</span> <span class="k">is</span>
  <span class="k">begin</span>

    <span class="c1">-- Tell the UART to send a command.</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">r_CLOCK</span><span class="p">);</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">r_CLOCK</span><span class="p">);</span>
    <span class="n">r_TX_DV</span>   <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
    <span class="n">r_TX_BYTE</span> <span class="o">&lt;=</span> <span class="mh">X&quot;AB&quot;</span><span class="p">;</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">r_CLOCK</span><span class="p">);</span>
    <span class="n">r_TX_DV</span>   <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">w_TX_DONE</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>


    <span class="c1">-- Send a command to the UART</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">r_CLOCK</span><span class="p">);</span>
    <span class="n">UART_WRITE_BYTE</span><span class="p">(</span><span class="mh">X&quot;3F&quot;</span><span class="p">,</span> <span class="n">r_RX_SERIAL</span><span class="p">);</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">r_CLOCK</span><span class="p">);</span>

    <span class="c1">-- Check that the correct command was received</span>
    <span class="k">if</span> <span class="n">w_RX_BYTE</span> <span class="o">=</span> <span class="mh">X&quot;3F&quot;</span> <span class="k">then</span>
      <span class="n">report</span> <span class="s">&quot;Test Passed - Correct Byte Received&quot;</span> <span class="k">severity</span> <span class="n">note</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">report</span> <span class="s">&quot;Test Failed - Incorrect Byte Received&quot;</span> <span class="k">severity</span> <span class="n">note</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

    <span class="k">assert</span> <span class="n">false</span> <span class="n">report</span> <span class="s">&quot;Tests Complete&quot;</span> <span class="k">severity</span> <span class="n">failure</span><span class="p">;</span>

  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

<span class="k">end</span> <span class="nc">behave</span><span class="p">;</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>