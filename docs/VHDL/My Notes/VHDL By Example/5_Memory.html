


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>5. Memory - VHDL Development</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#5-memory" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="VHDL Development" class="md-header-nav__button md-logo" aria-label="VHDL Development">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            VHDL Development
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              5. Memory
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="VHDL Development" class="md-nav__button md-logo" aria-label="VHDL Development">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    VHDL Development
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../VHDL%20By%20Application.html" title="VHDL By Application" class="md-nav__link">
      VHDL By Application
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../My%20Notes.html" title="My Notes" class="md-nav__link">
      My Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../Demo.html" title="Demo Markdown" class="md-nav__link">
      Demo Markdown
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="5-memory">5. Memory</h1>
<p>Memory can be defined in three ways:</p>
<ol>
<li>Infer the memory directly via the VHDL code<ul>
<li>This is the most portable and flexible option but also requires the most design effort and is likely to be the least efficient.  We may choose to use this less efficient option if our design is smaller than the smallest available primitive RAM block and save these primitives for where they are really needed.</li>
</ul>
</li>
<li>Build the memory using the vendor's primitive RAM structures<ul>
<li>This will be more efficient than the first option as it will use RAM resources built into the FPGA.  It will save design effort too as we will now only need to code the control structures around the primitive.</li>
</ul>
</li>
<li>Design the memory using the FPGA vendor's specialised tools (easiest but least portable).<ul>
<li>This is the easiest option in terms of design effort but does come with a heavily reliance on the vendor.  If the design is mitigated to different device in future these IP cores will need to be completely redesigned.  This may also be an issue if our code needs to be supported for a long time.  Any changes to the vendor's tool may have a direct impact on our design, or worse still the vendor may choose to make this tool obsolete entirely which may force a complete redesign within an existing product.  Obviously this may never be an issue, but does come with a rather large headache if it does.</li>
</ul>
</li>
</ol>
<p>Below we implement the same memory structure using option 1 (directly via VHDL code) with two different access methods, single port and dual port.
The dual port design has the advantage that read and write access is available simultaneously (or two simultaneous writes).  It also provides a method of moving data across clock domains.</p>
<div class="codehilite"><pre><span></span><code><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.numeric_std.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">SINGLE_PORT_RAM</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">CLK</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">DATA_IN</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">WR_ADDR</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">9</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">RD_ADDR</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">9</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">WR_EN</span>     <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">DATA_OUT</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">SINGLE_PORT_RAM</span><span class="p">;</span>
<span class="k">architecture</span> <span class="nc">RTL</span> <span class="k">of</span> <span class="nc">SINGLE_PORT_RAM</span> <span class="k">is</span>
  <span class="k">type</span> <span class="n">MEMBLK_1Kx16</span> <span class="k">is</span> <span class="k">array</span><span class="p">(</span><span class="mi">1023</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="k">of</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">RAM</span> <span class="o">:</span> <span class="n">MEMBLK_1Kx16</span>
<span class="k">begin</span>
  <span class="n">RAM_PROC</span> <span class="o">:</span> <span class="k">process</span><span class="p">(</span><span class="n">CLK</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">CLK</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span><span class="p">(</span><span class="n">WR_EN</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">WR_ADDR</span><span class="p">))</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DATA_IN</span><span class="p">;</span>
        <span class="n">DATA_OUT</span> <span class="o">&lt;=</span> <span class="n">DATA_IN</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">DATA_OUT</span> <span class="o">&lt;=</span> <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">RD_ADDR</span><span class="p">))</span> <span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">RAM_PROC</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span> <span class="nc">RTL</span><span class="p">;</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="k">library</span> <span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">ieee.numeric_std.</span><span class="k">all</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">DUAL_PORT_RAM</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="c1">-- Port A</span>
    <span class="n">CLK_A</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">WR_EN_A</span>     <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">ADDR_A</span>      <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">9</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DATA_IN_A</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DATA_OUT_A</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c1">-- Port B</span>
    <span class="n">CLK_B</span>       <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">WR_EN_B</span>     <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
    <span class="n">ADDR_B</span>      <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">9</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DATA_IN_B</span>   <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DATA_OUT_B</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">DUAL_PORT_RAM</span><span class="p">;</span>
<span class="k">architecture</span> <span class="nc">RTL</span> <span class="k">of</span> <span class="nc">DUAL_PORT_RAM</span> <span class="k">is</span>
  <span class="k">type</span> <span class="n">MEMBLK_1Kx16</span> <span class="k">is</span> <span class="k">array</span><span class="p">(</span><span class="mi">1023</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="k">of</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">signal</span> <span class="n">RAM</span> <span class="o">:</span> <span class="n">MEMBLK_1Kx16</span>
<span class="k">begin</span>
  <span class="n">RAM_PROC_A</span> <span class="o">:</span> <span class="k">process</span><span class="p">(</span><span class="n">CLK_A</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">CLK_A</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span><span class="p">(</span><span class="n">WR_EN_A</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">WR_ADDR_A</span><span class="p">))</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DATA_IN_A</span><span class="p">;</span>
        <span class="n">DATA_OUT_A</span> <span class="o">&lt;=</span> <span class="n">DATA_IN_A</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">DATA_OUT_A</span> <span class="o">&lt;=</span> <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">ADDR_A</span><span class="p">))</span> <span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">RAM_PROC_A</span><span class="p">;</span>

  <span class="n">RAM_PROC_B</span> <span class="o">:</span> <span class="k">process</span><span class="p">(</span><span class="n">CLK_B</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">CLK_B</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span><span class="p">(</span><span class="n">WR_EN_B</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">WR_ADDR_B</span><span class="p">))</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DATA_IN_B</span><span class="p">;</span>
        <span class="n">DATA_OUT_B</span> <span class="o">&lt;=</span> <span class="n">DATA_IN_B</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">DATA_OUT_B</span> <span class="o">&lt;=</span> <span class="n">RAM</span><span class="p">(</span> <span class="n">to_integer</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">(</span><span class="n">ADDR_B</span><span class="p">))</span> <span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">RAM_PROC_B</span><span class="p">;</span>  
<span class="k">end</span> <span class="k">architecture</span> <span class="nc">RTL</span><span class="p">;</span>
</code></pre></div>


<p>In our dual port design, we have no mechanism within VHDL to define the behaviour when the same address is accessed by both ports simultaneously.  The behaviour will be determined by  the synthesis software or the hardware fabric itself.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../../../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>